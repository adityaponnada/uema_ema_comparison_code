---
title: "perceived_burden_parsing"
author: "Aditya Ponnada"
date: "7/7/2021"
output: html_document
---

## import libraries
```{r}

library(ggplot2)
library(psych)
library(reshape2)
library(dplyr)


```

## Read in the burden file
```{r}


perceived_burden_data <- read.csv(file = "D:/uema_ema_comparison_CHI/perceived_burden/TIMEMAIN-AdityaBurden_DATA_2021-07-07_1126.csv", sep = ",", header = TRUE)

```


## Split into 6m and exit survey dfs

First, get the column names and then split column names into two
```{r}

all_col_names <- names(perceived_burden_data)

```

Get column names for 6 months survey
```{r}

common_cols <- c(1:3)
six_mon_cols <- c(4:52)
exit_cols <- c(53:112)

id_df <-perceived_burden_data[, common_cols]
six_mon_df <- perceived_burden_data[, six_mon_cols]
exit_df <- perceived_burden_data[, exit_cols]


```

Stitch the id columns to other dataframes
```{r}

six_mon_df <- cbind(id_df, six_mon_df)
exit_df <- cbind(id_df, exit_df)


```

keep only perceived burden scale related columns
```{r}

remove_six_mon_cols <- c(c(25:27), c(49:52))
remove_exit_cols <- c(c(25:33), c(55:63))


```

Remove these column names from the dataframes
```{r}

six_mon_df <- six_mon_df %>% select(-remove_six_mon_cols)

exit_df <- exit_df %>% select(-remove_exit_cols)

```

## Remove non exit survey users

Remove users who have not completed the exit survey
This is because either they are still active or they just did not fill it

```{r}

exit_df <- exit_df[!apply(is.na(exit_df[,4:45]), 1, all),]

```

Do the same for six months dataframe
```{r}

six_mon_df <- six_mon_df[!apply(is.na(six_mon_df[,4:45]), 1, all),]

```

## Rename columns in exit to match with 6 months
```{r}

exit_cols <- names(exit_df)

new_exit_cols <- c()

for (col_name in exit_cols){
  
  
  if (grepl( "engagement", col_name, fixed = TRUE)) {
    col_name <- gsub("_exit", "", col_name)
  }
  
  new_exit_cols <- c(new_exit_cols, col_name)
  
}

```

## Create a final unified data frame
Here, we use the latest responses by the participants. Thus we combine the exit df with six months df
But, we want to remove those users from six months df who have already completed the exit df

```{r}

`%!in%` <- Negate(`%in%`)

exit_users <- unique(exit_df$visualizerid)

names(exit_df) <- new_exit_cols

six_mon_df <- subset(six_mon_df, six_mon_df$visualizerid %!in% exit_users)

```

Now stitch them together
```{r}

final_df <- rbind(exit_df, six_mon_df)

```


## Reassign question names
The goal here is to categorize questions into subscales for easy computation

First read the question mapping file
```{r}


q_id_map_df <- read.csv(file="D:/uema_ema_comparison_CHI/perceived_burden/question_id_mapping.csv", sep=",", header=TRUE)

q_id_map_df$device_subscale_id <- paste0(q_id_map_df$Device, "_", q_id_map_df$Subscale_ID)

current_qid_list <- q_id_map_df$Q_ID
subscale_id_list <- q_id_map_df$device_subscale_id



```


Now add the first three columns to the subscale list
```{r}

subscale_id_list <- c(c("record_id", "visualizerid", "participant_status"), subscale_id_list)

```

Now replace the column names
```{r}
names(final_df) <- subscale_id_list
```


## get burden scores

First get the total score. For that we create a new df excluding the fun and rewarding questions

```{r}

exclude_columns <- c("phone_cognitive_7", "phone_cognitive_8", "watch_cognitive_7", "watch_cognitive_8")

final_burden_df <- dplyr::select(final_df, -exclude_columns)


```

add total score
```{r}

all_burden_cols=names(final_burden_df)[4:41]
phone_burden_col = names(final_burden_df)[4:22]
watch_burden_col = names(final_burden_df)[23:41]
final_burden_df$total_phone_burden <- rowSums(final_burden_df[,phone_burden_col], na.rm = TRUE)
final_burden_df$total_watch_burden <- rowSums(final_burden_df[,watch_burden_col], na.rm = TRUE)

```

add subscale scores
```{r}

difficult_burden = c("difficult_1", "difficult_2", "difficult_3", "difficult_4")
physical_burden = c("physical_1", "physical_2")
timesocial_burden = c("timesocial_1", "timesocial_2", "timesocial_3", "timesocial_4")
cognitive_burden = c("cognitive_1", "cognitive_2", "cognitive_3", "cognitive_4", "cognitive_5", "cognitive_6")
interruption_burden = c("interrupt_1", "interrupt_2", "interrupt_3")

difficult_burden_watch <- paste0("watch_", difficult_burden)
physical_burden_watch <- paste0("watch_", physical_burden)
timesocial_burden_watch <- paste0("watch_", timesocial_burden)
cognitive_burden_watch <- paste0("watch_", cognitive_burden)
interruption_burden_watch <- paste0("watch_", interruption_burden)

difficult_burden_phone <- paste0("phone_", difficult_burden)
physical_burden_phone <- paste0("phone_", physical_burden)
timesocial_burden_phone <- paste0("phone_", timesocial_burden)
cognitive_burden_phone <- paste0("phone_", cognitive_burden)
interruption_burden_phone <- paste0("phone_", interruption_burden)

```


compute subscale scores
```{r}


final_burden_df$difficult_burden_phone <- rowSums(final_burden_df[,difficult_burden_phone], na.rm = TRUE)
final_burden_df$physical_burden_phone <- rowSums(final_burden_df[,physical_burden_phone], na.rm = TRUE)
final_burden_df$timesocial_burden_phone <- rowSums(final_burden_df[,timesocial_burden_phone], na.rm = TRUE)
final_burden_df$cognitive_burden_phone <- rowSums(final_burden_df[,cognitive_burden_phone], na.rm = TRUE)
final_burden_df$interruption_burden_phone <- rowSums(final_burden_df[,interruption_burden_phone], na.rm = TRUE)

final_burden_df$difficult_burden_watch <- rowSums(final_burden_df[,difficult_burden_watch], na.rm = TRUE)
final_burden_df$physical_burden_watch <- rowSums(final_burden_df[,physical_burden_watch], na.rm = TRUE)
final_burden_df$timesocial_burden_watch <- rowSums(final_burden_df[,timesocial_burden_watch], na.rm = TRUE)
final_burden_df$cognitive_burden_watch <- rowSums(final_burden_df[,cognitive_burden_watch], na.rm = TRUE)
final_burden_df$interruption_burden_watch <- rowSums(final_burden_df[,interruption_burden_watch], na.rm = TRUE)

```


## Check general ranges
```{r}

describe(final_burden_df$total_phone_burden)
describe(final_burden_df$total_watch_burden)

describe(final_burden_df$difficult_burden_phone)
describe(final_burden_df$difficult_burden_watch)

describe(final_burden_df$physical_burden_phone)
describe(final_burden_df$physical_burden_watch)

describe(final_burden_df$timesocial_burden_phone)
describe(final_burden_df$timesocial_burden_watch)

describe(final_burden_df$cognitive_burden_phone)
describe(final_burden_df$cognitive_burden_watch)

describe(final_burden_df$interruption_burden_phone)
describe(final_burden_df$interruption_burden_watch)


```

