---
title: "uema_ema_corr"
output: html_document
date: "2025-01-16"
---

## Import library
```{r}

library(dplyr)
library(reshape2)
library(ggplot2)
library(psych)
library(readr)
library(purrr)
library(tidyr)
```

## Read EMA data
```{r}

ema_df <- read.csv("/Users/adityaponnada/Downloads/time_study_data/EMA_data.csv", sep = ",", header = TRUE)

```

## Read uEMA data
```{r}
# Set the path to folder
folder_path <- "/Users/adityaponnada/Downloads/time_study_data/uema_data"

# List all files matching the pattern B_*.csv
files <- list.files(path = folder_path, pattern = "watch_promptresponse_.*@timestudy_com\\.csv$", full.names = TRUE)

# Read and combine all CSV files
uema_df <- files %>%
  map_df(read_csv)


```

## Subset data frames
```{r}

keep_uema <- c("Participant_ID", "Question_X_ID", "Answer_Status", "Question_X_Text", "Question_X_Answer_Text")

uema_df <- uema_df[, keep_uema]

```

### Check distributions
```{r}

table(uema_df$Answer_Status)

table(uema_df$Question_X_ID)

```

### Check participant distribution
```{r}

n_distinct(uema_df$Participant_ID)

```

## Keep only completed responses
```{r}

uema_df <- subset(uema_df, Answer_Status %in% c("Completed", "CompletedThenDismissed", "PartiallyCompleted"))

```

### Reformat question ID
```{r}

uema_df$Question_X_ID <- sub("_.*", "", uema_df$Question_X_ID)


```

### Keep only relevant questions
```{r}

uema_questions <- c("tense", "stress", "sad", "routine", "relax", "nervous", "happy", "frust", "focus", "fatigue", "control")

uema_df <- subset(uema_df, Question_X_ID %in% uema_questions)

```

### Score responses
```{r}

uema_df <- uema_df %>%
  mutate(Answer_Score = case_when(
    Question_X_Answer_Text == "Yes" ~ 3,
    Question_X_Answer_Text == "Sort of" ~ 2,
    Question_X_Answer_Text == "No" ~ 1,
    TRUE ~ NA_real_  # This handles any other values not specified above
  ))

```

### Remove remaining NOT_ANS
```{r}

uema_df <- subset(uema_df, !is.na(uema_df$Answer_Score))

```


### Compute variance for each question
```{r}

uema_wide_df <- uema_df %>%
  group_by(Participant_ID, Question_X_ID) %>%
  summarise(Answer_Score_Var = var(Answer_Score, na.rm = TRUE)) %>%
  pivot_wider(names_from = Question_X_ID, values_from = Answer_Score_Var)

```

## EMA data prep - filter the relevant columns
```{r}

ema_df <- subset(ema_df, ema_df$Answer_Status %in% c("Completed", "PartiallyCompleted"))

```

### keep only selected columns
```{r}

keep_ema <- c("participant_id", "Answer_Status", "x01_sad", "x02_happy", "x03_fatigued", "x05_relaxed", "x06_tense", "x07_stressed"  , "x08_frustrated", "x09_nervous", "x10_focused", "x11_control", "x14_routine")

ema_df <- ema_df[, keep_ema]

```

### Rename columns
```{r}

colnames(ema_df) <- c("Participant_ID", "Answer_Status", "sad", "happy", "fatigue", "relax", "tense", "stress", "frust", "nervous", "focus", "control", "routine")

```

### Compute variance for each question
```{r}

ema_wide_df <- ema_df %>%
  group_by(Participant_ID) %>%
  summarise(across(c(sad, happy, fatigue, relax, tense, stress, frust, nervous, focus, control, routine), var, na.rm = TRUE))

```

